<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard ‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡πâ‡∏≥‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons CDN -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- D3.js CDN for charts -->
    <script src="https://d3js.org/d3.v7.min.js"></script> 
    
    <style>
        /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ü‡∏≠‡∏ô‡∏ï‡πå Inter ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Tailwind */
        :root {
            font-family: 'Inter', sans-serif;
        }
        
        html, body {
            height: 100%; 
            margin: 0;
            padding: 0;
            overflow: hidden; 
        }
        
        .full-screen-container {
            height: 100vh; 
            display: flex;
            flex-direction: column;
            padding: 1.5rem; 
        }

        /* -------------------------------------------------------- */
        /* Custom Grid: Main Layout (‡πÉ‡∏ä‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠) */
        /* -------------------------------------------------------- */
        .custom-dashboard-grid {
            height: 100%; 
            display: grid;
            /* ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£: 1.5fr (‡∏ö‡∏ô) / 1fr (‡∏•‡πà‡∏≤‡∏á) */
            grid-template-rows: 1.5fr 1fr; 
            grid-template-columns: repeat(12, 1fr); 
            gap: 1.5rem;
            overflow: hidden; 
        }

        /* Grid Areas Mapping (No Change) */
        .area-1-orange { grid-column: span 8; grid-row: 1; }
        .area-2-yellow { grid-column: span 4; grid-row: 1; }
        .area-3-blue { grid-column: span 4; grid-row: 2; }
        .area-4-green { grid-column: span 8; grid-row: 2; }
        
        /* -------------------------------------------------------- */
        /* Table Layout (Sheet 1 & 2) */
        /* -------------------------------------------------------- */
        .fluid-table {
            table-layout: fixed; /* ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÉ‡∏ä‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î */
            width: 100%; 
            border-collapse: collapse;
        }
        
        /* Area 1: Table (8/12 Width - ‡πÄ‡∏¢‡∏≠‡∏∞) */
        .table-td-area1, .table-th-area1 {
            padding: 0.35em 0.6em; 
            font-size: 0.8em; 
        }

        /* Area 2: Table (4/12 Width - ‡∏ô‡πâ‡∏≠‡∏¢) */
        .table-td-area2, .table-th-area2 { 
            padding: 0.15em 0.3em;
            font-size: 0.8em; 
        }
        
        /* Bounding TH/TD Widths for fluid-table */
        .fluid-table thead th:nth-child(1), .fluid-table tbody td:nth-child(1) { width: 40%; } /* ‡∏à‡∏∏‡∏î‡∏ß‡∏±‡∏î - ‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏™‡∏∏‡∏î */
        .fluid-table thead th:nth-child(2), .fluid-table tbody td:nth-child(2) { width: 25%; } /* ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô - ‡∏Å‡∏•‡∏≤‡∏á */
        .fluid-table thead th:nth-child(3), .fluid-table tbody td:nth-child(3) { width: 20%; } /* ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á - ‡πÅ‡∏Ñ‡∏ö */
        .fluid-table thead th:nth-child(4), .fluid-table tbody td:nth-child(4) { width: 15%; } /* ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô - ‡πÅ‡∏Ñ‡∏ö‡∏™‡∏∏‡∏î */

        .status-badge {
            padding: 0.05rem 0.3rem; 
            font-size: 0.7em; /* ‡πÄ‡∏•‡πá‡∏Å‡∏•‡∏á */
        }
        
        /* D3 Chart Text Styling - ‡πÉ‡∏´‡πâ‡πÄ‡∏•‡πá‡∏Å‡∏•‡∏á */
        #rainfall-chart-container text {
            font-family: 'Inter', sans-serif;
            font-size: 0.65rem; /* 10.4px */
        }
        
        /* Mobile Fallback */
        @media (max-width: 768px) {
            .custom-dashboard-grid {
                display: flex;
                flex-direction: column;
                height: auto; 
                overflow-y: auto;
            }
            .area-1-orange, .area-2-yellow, .area-3-blue, .area-4-green {
                width: 100%;
                grid-column: span 12;
                grid-row: auto;
                min-height: 400px;
            }
        }
    </style>
</head>
<body class="bg-gray-50 full-screen-container">
    
    <script>
        // =================================================================================================================================================
        // ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡∏∞ URL ‡∏Ç‡∏≠‡∏á‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°)
        // =================================================================================================================================================
        
        // *************************************************************************************************************************************************
        // ** ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà URL ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏´‡∏•‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢ URL ‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á Google Sheets ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà‡πÄ‡∏õ‡πá‡∏ô CSV **
        // *************************************************************************************************************************************************
        const GOOGLE_SHEET_URL_1 = "https://docs.google.com/spreadsheets/d/e/2PACX-1vT452CdpcF_hoA-_x3a6Ji0YKeWTuSr_9CM0We83aAAPiBWMRoHrKEujaYtEzHMZYMLEL8wKa10NPYF/pub?gid=675852265&single=true&output=csv"; // ‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡∏±‡∏î‡∏£‡∏∞‡∏î‡∏±‡∏ö
        const GOOGLE_SHEET_URL_2 = "https://docs.google.com/spreadsheets/d/e/2PACX-1vT5OYSm3Hn1V4kegJf9x3iK2OGvUIL7vbnWryNUsx15VCm4NdxoVoWZMx1vWTlKcZskeD-YYjhbKn2V/pub?gid=202563025&single=true&output=csv"; // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡πÄ‡∏à‡πâ‡∏≤‡∏û‡∏£‡∏∞‡∏¢‡∏≤
        const GOOGLE_SHEET_URL_3 = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTyPcfGQReUPOHckF-6bA4UOucC8cbqRvHj-aTP7uWRkBjvQ4HrieGIhcet4OH9O0DjT_M2FM3QaaV9/pub?gid=273571070&single=true&output=csv"; // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏π‡∏ö‡∏ô‡πâ‡∏≥
        const GOOGLE_SHEET_URL_4 = "https://docs.google.com/spreadsheets/d/e/2PACX-1vS5qwzKbaRjpA3iUXbyNMg9Y0tYdlVwykSAxz1V_CxMoT6PwnmMZjKvSNR2PpSWFjwbr9aG8uIU23tN/pub?gid=77454851&single=true&output=csv"; // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏ô‡πâ‡∏≥‡∏ù‡∏ô 
        
        const UPDATE_INTERVAL_MS = 3600000;

        const PLACEHOLDER_URL_CHECK = 
            GOOGLE_SHEET_URL_1.includes('{SHEET_ID_1}') || 
            GOOGLE_SHEET_URL_2.includes('{SHEET_ID_2}') || 
            GOOGLE_SHEET_URL_3.includes('{SHEET_ID_3}') || 
            GOOGLE_SHEET_URL_4.includes('{SHEET_ID_4}');

        // =================================================================================================================================================
        // ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå (USER CONFIGURATION) ‡πÅ‡∏•‡∏∞ KEY MAP (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°)
        // =================================================================================================================================================
        
        const USER_COLUMN_NAMES = {
            SHEET_1_2: {
                POINT: '‡∏à‡∏∏‡∏î‡∏ß‡∏±‡∏î',                 
                LEVEL: '‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô',       
                DIFF: '‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥',         
                ALERT: '‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô',       
            },
            SHEET_3: {
                STATION: '‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏™‡∏π‡∏ö‡∏ô‡πâ‡∏≥',           
                STATUS: '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡πä‡∏°',             
                UPDATE: '‡πÄ‡∏ß‡∏•‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î',             
                INSPECTIONS: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ï‡∏£‡∏ß‡∏à', 
            },
             SHEET_4: {
                POINT: '‡∏à‡∏∏‡∏î‡∏ß‡∏±‡∏î‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏ô‡πâ‡∏≥‡∏ù‡∏ô',     
                AMOUNT: '‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏ô‡πâ‡∏≥‡∏ù‡∏ô',          
                DURATION: '‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ù‡∏ô‡∏ï‡∏Å',       
            }
        };

        function sanitizeText(text) {
            if (!text) return '';
            return text.trim().replace(/\s+/g, '').replace(/\uFEFF/g, '');
        }

        const KEY_MAP = {
            WATER_POINT: sanitizeText(USER_COLUMN_NAMES.SHEET_1_2.POINT), 
            CURRENT_LEVEL: sanitizeText(USER_COLUMN_NAMES.SHEET_1_2.LEVEL),
            DIFF_LEVEL: sanitizeText(USER_COLUMN_NAMES.SHEET_1_2.DIFF),
            ALERT_LEVEL: sanitizeText(USER_COLUMN_NAMES.SHEET_1_2.ALERT),

            PUMP_STATION: sanitizeText(USER_COLUMN_NAMES.SHEET_3.STATION),
            PUMP_STATUS: sanitizeText(USER_COLUMN_NAMES.SHEET_3.STATUS),
            LAST_UPDATE: sanitizeText(USER_COLUMN_NAMES.SHEET_3.UPDATE),
            INSPECTIONS: sanitizeText(USER_COLUMN_NAMES.SHEET_3.INSPECTIONS), 
            
            RAIN_POINT: sanitizeText(USER_COLUMN_NAMES.SHEET_4.POINT), 
            RAIN_AMOUNT: sanitizeText(USER_COLUMN_NAMES.SHEET_4.AMOUNT),
            RAIN_DURATION: sanitizeText(USER_COLUMN_NAMES.SHEET_4.DURATION),
        };

        function csvToArray(csvText) {
             const lines = csvText.split(/\r?\n/).filter(line => line.trim() !== '');
            if (lines.length === 0) return [];

            const rawHeaders = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
            const cleanHeaders = rawHeaders.map(h => sanitizeText(h)); 
            
            const result = [];

            for (let i = 1; i < lines.length; i++) {
                const currentLine = lines[i];
                const values = currentLine.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(v => v.trim().replace(/"/g, ''));
                
                if (values.length === cleanHeaders.length) {
                    const obj = {};
                    let hasRequiredKey = false;
                    for (let j = 0; j < cleanHeaders.length; j++) {
                        obj[cleanHeaders[j]] = values[j]; 
                        if (cleanHeaders[j] === KEY_MAP.WATER_POINT || cleanHeaders[j] === KEY_MAP.PUMP_STATION || cleanHeaders[j] === KEY_MAP.RAIN_POINT) {
                             hasRequiredKey = true;
                        }
                    }
                    if (hasRequiredKey) {
                         result.push(obj);
                    }
                }
            }
            return result;
        }

        async function fetchDataFromSheet(url) {
            console.log(`[INFO] Attempting to fetch data from URL: ${url}`);
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status} from ${url}`);
                }
                const csvText = await response.text();
                return csvToArray(csvText);
            } catch (error) {
                console.error("Error fetching or parsing sheet data:", error);
                return [
                    { 'ERROR_KEY': 'N/A (Error)', [KEY_MAP.ALERT_LEVEL]: '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠' },
                ];
            }
        }

        async function fetchWaterLevelData() { return fetchDataFromSheet(GOOGLE_SHEET_URL_1); }
        async function fetchChaoPhrayaData() { return fetchDataFromSheet(GOOGLE_SHEET_URL_2); }
        async function fetchPumpStatusData() { return fetchDataFromSheet(GOOGLE_SHEET_URL_3); }
        async function fetchRainfallData() { return fetchDataFromSheet(GOOGLE_SHEET_URL_4); }
        
        // =================================================================================================================================================
        // ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 3: ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• (Rendering)
        // =================================================================================================================================================
        
        /**
         * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î Style, Icon, ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô (Sheet 1 & 2)
         * ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ '‡∏ß‡∏¥‡∏Å‡∏§‡∏ï‡∏¥' ‡πÅ‡∏•‡∏∞ '‡∏õ‡∏Å‡∏ï‡∏¥' ‡πÉ‡∏ä‡πâ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏™‡∏µ‡∏≠‡πà‡∏≠‡∏ô (Light Background) ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô '‡πÄ‡∏ù‡πâ‡∏≤‡∏£‡∏∞‡∏ß‡∏±‡∏á'
         */
        function getAlertStyles(alertLevel) {
            const sanitizedLevel = sanitizeText(alertLevel);
            
            // 1. ‡∏ß‡∏¥‡∏Å‡∏§‡∏ï‡∏¥ (‡∏™‡∏µ‡πÅ‡∏î‡∏á‡∏≠‡πà‡∏≠‡∏ô/‡πÅ‡∏î‡∏á‡πÄ‡∏Ç‡πâ‡∏°, ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô BellRing, ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° "‡∏ß‡∏¥‡∏Å‡∏§‡∏ï‡∏¥")
            if (sanitizedLevel.includes('‡∏ß‡∏¥‡∏Å‡∏§‡∏ï‡∏¥') || sanitizedLevel.includes('‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢') || sanitizedLevel.includes('‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥')) {
                return { 
                    // üö® NEW: ‡πÉ‡∏ä‡πâ Light Background ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏™‡πÑ‡∏ï‡∏•‡πå '‡πÄ‡∏ù‡πâ‡∏≤‡∏£‡∏∞‡∏ß‡∏±‡∏á'
                    color: 'bg-red-100 text-red-800 ring-red-300', 
                    icon: 'BellRing', 
                    displayText: '‡∏ß‡∏¥‡∏Å‡∏§‡∏ï‡∏¥' 
                };
            }
            
            // 2. ‡πÄ‡∏ù‡πâ‡∏≤‡∏£‡∏∞‡∏ß‡∏±‡∏á (‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á‡∏≠‡πà‡∏≠‡∏ô/‡∏™‡πâ‡∏°‡πÄ‡∏Ç‡πâ‡∏°, ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô Eye, ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° "‡πÄ‡∏ù‡πâ‡∏≤‡∏£‡∏∞‡∏ß‡∏±‡∏á") **‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏ó‡πà‡∏≤‡∏ô‡∏ä‡∏∑‡πà‡∏ô‡∏ä‡∏≠‡∏ö (Keep)**
            if (sanitizedLevel.includes('‡πÄ‡∏ù‡πâ‡∏≤‡∏£‡∏∞‡∏ß‡∏±‡∏á') || sanitizedLevel.includes('‡∏™‡∏π‡∏á') || sanitizedLevel.includes('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô')) {
                return { 
                    color: 'bg-amber-100 text-amber-800 ring-amber-300', 
                    icon: 'Eye', 
                    displayText: '‡πÄ‡∏ù‡πâ‡∏≤‡∏£‡∏∞‡∏ß‡∏±‡∏á' 
                };
            }
            
            // 3. ‡∏õ‡∏Å‡∏ï‡∏¥ (‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏≠‡πà‡∏≠‡∏ô/‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡πÄ‡∏Ç‡πâ‡∏°, ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô CheckCircle, ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° "‡∏õ‡∏Å‡∏ï‡∏¥")
            if (sanitizedLevel.includes('‡∏õ‡∏Å‡∏ï‡∏¥') || sanitizedLevel.includes('‡∏ó‡∏≥‡∏á‡∏≤‡∏ô')) {
                return { 
                    // üü¢ NEW: ‡πÉ‡∏ä‡πâ Light Background ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏™‡πÑ‡∏ï‡∏•‡πå '‡πÄ‡∏ù‡πâ‡∏≤‡∏£‡∏∞‡∏ß‡∏±‡∏á'
                    color: 'bg-green-100 text-green-800 ring-green-300', 
                    icon: 'CheckCircle', 
                    displayText: '‡∏õ‡∏Å‡∏ï‡∏¥' 
                };
            }
            
            // Default/N/A
            return { 
                color: 'bg-gray-100 text-gray-800 ring-gray-300', 
                icon: 'Info',
                displayText: 'N/A' 
            };
        }

        function getDiffIcon(diff) {
            const numDiff = parseFloat(diff);
            if (isNaN(numDiff)) return { icon: 'Minus', iconColor: 'text-gray-500' };

            if (numDiff > 0.001) {
                return { icon: 'ArrowUp', iconColor: 'text-red-500' }; 
            } else if (numDiff < -0.001) {
                return { icon: 'ArrowDown', iconColor: 'text-green-500' }; 
            } else {
                return { icon: 'Minus', iconColor: 'text-gray-500' };
            }
        }

        /**
         * ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ñ‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥ (Sheet 1 & 2)
         */
        function createWaterTableRow(data, isSheet1) {
            const alertLevelRaw = data[KEY_MAP.ALERT_LEVEL] || 'N/A';
            const alertStyles = getAlertStyles(alertLevelRaw);
            const diffValue = data[KEY_MAP.DIFF_LEVEL] || '0.00';
            const diffIcon = getDiffIcon(diffValue);

            const displayLevel = data[KEY_MAP.CURRENT_LEVEL] || 'N/A';
            const pointName = data[KEY_MAP.WATER_POINT] || '';
            let unit = '‡∏£‡∏ó‡∏Å./MSL.'; 

            if (pointName.includes('‡πÄ‡∏Ç‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏û‡∏£‡∏∞‡∏¢‡∏≤')) { unit = '‡∏•‡∏ö.‡∏°./‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ'; } 
            if (displayLevel === 'N/A') { unit = ''; }

            const tdClass = isSheet1 ? 'table-td-area1' : 'table-td-area2';
            
            // Font size ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Sheet 2 "‡∏à‡∏∏‡∏î‡∏ß‡∏±‡∏î" column
            const pointNameClass = (!isSheet1) ? 'text-[1.1em] font-semibold' : 'font-medium'; 

            return `
                <tr class="border-b hover:bg-gray-50 transition duration-150">
                    <td class="${tdClass} whitespace-normal text-gray-900 ${pointNameClass}">
                        ${data[KEY_MAP.WATER_POINT] || 'N/A'} 
                    </td>
                    <td class="${tdClass} whitespace-nowrap font-bold text-gray-900 text-[1.1em]">
                        ${displayLevel} 
                        <span class="text-[0.6em] font-normal opacity-80">${unit}</span>
                    </td>
                    <td class="${tdClass} whitespace-nowrap text-[0.9em] text-gray-600">
                        <div class="flex items-center space-x-1 justify-center">
                            <span class="font-semibold ${diffIcon.iconColor} whitespace-nowrap">
                                ${diffValue}
                            </span>
                            <i data-lucide="${diffIcon.icon}" class="w-[0.8em] h-[0.8em] ${diffIcon.iconColor}"></i>
                        </div>
                    </td>
                    <!-- ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏õ‡πâ‡∏≤‡∏¢‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏™‡∏µ‡∏à‡∏≤‡∏Å alertStyles.color ‡∏ã‡∏∂‡πà‡∏á‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏≠‡πà‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡πÄ‡∏Ç‡πâ‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î -->
                    <td class="${tdClass} whitespace-nowrap text-center">
                        <div class="flex justify-center items-center w-full h-full"> 
                            <span class="status-badge ${alertStyles.color} ring-1 ring-inset inline-flex items-center space-x-1 justify-center">
                                <i data-lucide="${alertStyles.icon}" class="w-[0.7em] h-[0.7em]"></i>
                                ${alertStyles.displayText}
                            </span>
                        </div>
                    </td>
                </tr>
            `;
        }
        
        /**
         * ‡∏™‡∏£‡πâ‡∏≤‡∏á Card ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡πä‡∏° (Sheet 3)
         */
        function createPumpStatusCard(data) {
            const pumpStation = data[KEY_MAP.PUMP_STATION] || 'N/A';
            const pumpStatus = data[KEY_MAP.PUMP_STATUS] || '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞';
            const inspectionCount = data[KEY_MAP.INSPECTIONS] || '0'; 
            const sanitizedStatus = sanitizeText(pumpStatus);

            let bgColor = 'bg-gray-100';
            let textColor = 'text-gray-800';
            let icon = 'Info';

            // ‡πÉ‡∏ä‡πâ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏µ‡πÉ‡∏´‡πâ‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡πÇ‡∏ó‡∏ô '‡πÄ‡∏ù‡πâ‡∏≤‡∏£‡∏∞‡∏ß‡∏±‡∏á' (‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á‡∏≠‡πà‡∏≠‡∏ô) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
            if (sanitizedStatus.includes('‡∏õ‡∏Å‡∏ï‡∏¥') || sanitizedStatus.includes('‡∏ó‡∏≥‡∏á‡∏≤‡∏ô')) {
                bgColor = 'bg-green-100';
                textColor = 'text-green-800';
                icon = 'CheckCircle';
            } else if (sanitizedStatus.includes('‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥') || sanitizedStatus.includes('‡∏ß‡∏¥‡∏Å‡∏§‡∏ï‡∏¥') || sanitizedStatus.includes('‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô') || sanitizedStatus.includes('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô')) {
                // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ‡∏™‡∏π‡∏ö‡∏ô‡πâ‡∏≥‡∏ó‡∏µ‡πà‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡∏¥‡∏Å‡∏§‡∏ï ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡πÇ‡∏ó‡∏ô‡∏™‡∏µ‡πÅ‡∏î‡∏á
                bgColor = 'bg-red-100';
                textColor = 'text-red-800';
                icon = 'AlertTriangle';
            } else if (sanitizedStatus.includes('‡πÄ‡∏ù‡πâ‡∏≤‡∏£‡∏∞‡∏ß‡∏±‡∏á') || sanitizedStatus.includes('‡∏™‡∏π‡∏á')) {
                // ‡πÉ‡∏ä‡πâ‡πÇ‡∏ó‡∏ô‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á‡∏≠‡πà‡∏≠‡∏ô ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏ù‡πâ‡∏≤‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏π‡∏ö‡∏ô‡πâ‡∏≥
                bgColor = 'bg-yellow-100';
                textColor = 'text-yellow-800';
                icon = 'Eye';
            } else {
                bgColor = 'bg-yellow-100'; // Default ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á‡∏≠‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÄ‡∏ù‡πâ‡∏≤‡∏£‡∏∞‡∏ß‡∏±‡∏á
                textColor = 'text-yellow-800';
                icon = 'Eye';
            }


            const safeStationName = pumpStation.replace(/'/g, "\\'");
            const safeInspectionCount = inspectionCount.replace(/'/g, "\\'");
            
            // **‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á Card (Center ‡∏ó‡∏±‡πâ‡∏á‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô)**
            return `
                <div 
                    class="p-2 ${bgColor} rounded-lg shadow-sm ring-1 ring-inset ring-opacity-50 
                           flex flex-col items-center justify-center text-center 
                           transition duration-200 hover:ring-2 hover:ring-offset-2 hover:ring-opacity-100 cursor-pointer w-full h-full"
                    onclick="showInspectionModal('${safeStationName}', '${safeInspectionCount}')"
                >
                    <i data-lucide="${icon}" class="w-5 h-5 mb-1 ${textColor} flex-shrink-0"></i> 
                    <span class="text-sm font-semibold ${textColor} whitespace-normal" title="${pumpStation}" style="word-break: break-word;">
                        ${pumpStation}
                    </span>
                    <span class="text-xs ${textColor} opacity-85 mt-[-2px] whitespace-normal" title="${pumpStatus}" style="word-break: break-word;">
                        ${pumpStatus}
                    </span>
                </div>
            `;
        }

        function showInspectionModal(stationName, inspectionCount) {
            const modal = document.getElementById('inspection-modal');
            const stationNameElement = document.getElementById('modal-station-name');
            const inspectionCountElement = document.getElementById('modal-inspection-count');

            if (modal && stationNameElement && inspectionCountElement) {
                stationNameElement.textContent = stationName;
                inspectionCountElement.textContent = inspectionCount; 
                modal.classList.remove('hidden');
                modal.classList.add('flex');
            }
        }

        function closeInspectionModal() {
            const modal = document.getElementById('inspection-modal');
            if (modal) {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
            }
        }
        
        function displaySheet4Error(containerId, data) {
            const container = document.querySelector(containerId);
            const isUrlPlaceholder = GOOGLE_SHEET_URL_4.includes('{SHEET_ID_4}');
            
            let message = '';
            let title = '';

            if (isUrlPlaceholder) {
                 title = "‚ùó ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏ URL ‡∏Ç‡∏≠‡∏á Sheet 4";
                 message = "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà GOOGLE_SHEET_URL_4 ‡∏î‡πâ‡∏ß‡∏¢ Link CSV ‡∏ó‡∏µ‡πà‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏Ç‡∏≠‡∏á‡∏ó‡πà‡∏≤‡∏ô";
            } else if (data.length === 0 || (data.length > 0 && (data[0]?.['ERROR_KEY'] || '').includes('Error'))) {
                 title = "‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Sheet 4 ‡πÑ‡∏î‡πâ";
                 message = "‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö URL/‡∏Å‡∏≤‡∏£‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà ‡πÅ‡∏•‡∏∞‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏´‡∏•‡∏±‡∏Å";
            } else {
                 title = "‚ö†Ô∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏≤‡∏ü";
                 message = "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡πà‡∏≤ '‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏ô‡πâ‡∏≥‡∏ù‡∏ô' ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç ‡∏´‡∏£‡∏∑‡∏≠ '‡∏à‡∏∏‡∏î‡∏ß‡∏±‡∏î' ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á";
            }
            
            container.innerHTML = `
                <div class="p-4 text-center bg-red-50/50 rounded-lg border border-red-300 h-full flex flex-col items-center justify-center">
                    <h3 class="text-xl font-bold text-red-800 mb-1">${title}</h3>
                    <p class="text-red-700 text-sm">${message}</p>
                </div>
            `;
        }
        
        // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Rainfall ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÑ‡∏ß‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ß‡∏≤‡∏î‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ
        let latestRainfallData = [];
        
        /**
         * ‡∏ß‡∏≤‡∏î‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ó‡πà‡∏á‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏ô‡πâ‡∏≥‡∏ù‡∏ô‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ D3.js (Sheet 4) 
         */
        function drawRainfallBarChart(data) {
            latestRainfallData = data; // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
            const containerId = '#rainfall-chart-container';
            const container = document.querySelector(containerId);
            
            // ‡∏•‡πâ‡∏≤‡∏á SVG ‡πÄ‡∏Å‡πà‡∏≤
            d3.select(containerId).select("svg").remove();

            const isUrlPlaceholder = GOOGLE_SHEET_URL_4.includes('{SHEET_ID_4}');
            const isFetchError = data.length === 0 || (data.length > 0 && (data[0]?.['ERROR_KEY'] || '').includes('Error'));

            if (isUrlPlaceholder || isFetchError) {
                displaySheet4Error(containerId, data);
                return;
            }

            const chartData = data
                .map(d => ({
                    point: d[KEY_MAP.RAIN_POINT] || 'N/A',
                    amount: parseFloat(d[KEY_MAP.RAIN_AMOUNT])
                }))
                .filter(d => !isNaN(d.amount) && d.point !== 'N/A' && d.amount >= 0);

            if (chartData.length === 0) {
                 displaySheet4Error(containerId, data);
                 return;
            }
            
            // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡πÅ‡∏•‡∏∞‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï
            const margin = { top: 20, right: 10, bottom: 60, left: 40 }; 
            
            // ‡πÉ‡∏ä‡πâ‡∏Ç‡∏ô‡∏≤‡∏î‡∏Ç‡∏≠‡∏á Container ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏≤‡∏ü‡∏û‡∏≠‡∏î‡∏µ‡∏Å‡∏£‡∏≠‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)
            const containerWidth = container.clientWidth;
            const containerHeight = container.clientHeight; 
            
            const width = Math.max(containerWidth - margin.left - margin.right, 50); // Min width 50
            const height = Math.max(containerHeight - margin.top - margin.bottom, 50); // Min height 50

            if (width < 50 || height < 50) return; // ‡πÑ‡∏°‡πà‡∏ß‡∏≤‡∏î‡∏ñ‡πâ‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡πá‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á SVG Element
            const svg = d3.select(containerId)
                .append("svg")
                .attr("width", containerWidth)
                .attr("height", containerHeight)
                .attr("viewBox", `0 0 ${containerWidth} ${containerHeight}`)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);
                
            // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î Scale
            const x = d3.scaleBand()
                .domain(chartData.map(d => d.point))
                .range([0, width])
                .padding(0.3);

            const y = d3.scaleLinear()
                .domain([0, d3.max(chartData, d => d.amount) * 1.1]) 
                .range([height, 0]);

            // ‡∏ß‡∏≤‡∏î Axis
            // X-Axis
            svg.append("g")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x).tickSizeOuter(0))
                .selectAll("text")
                .attr("transform", "translate(-10,0)rotate(-45)") 
                .style("text-anchor", "end")
                .style("font-size", "0.65rem"); 

            // Y-Axis
            svg.append("g")
                .call(d3.axisLeft(y).ticks(5))
                .style("font-size", "0.65rem"); 

            // Y-Axis Label
            svg.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 0 - margin.left + 2)
                .attr("x", 0 - (height / 2))
                .attr("dy", "0.8em")
                .style("text-anchor", "middle")
                .style("font-size", "0.75rem")
                .style("fill", "#4b5563")
                .text("‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏ô‡πâ‡∏≥‡∏ù‡∏ô (‡∏°‡∏°.)"); 

            // ‡∏ß‡∏≤‡∏î Bar
            svg.selectAll(".bar")
                .data(chartData)
                .enter().append("rect")
                .attr("class", "bar")
                .attr("x", d => x(d.point))
                .attr("y", height) 
                .attr("width", x.bandwidth())
                .attr("height", 0) 
                .attr("fill", "#2563eb") // Blue-600
                .attr("rx", 3) 
                .transition() 
                .duration(800)
                .delay((d, i) => i * 100)
                .attr("y", d => y(d.amount))
                .attr("height", d => height - y(d.amount));
                
            // ‡πÄ‡∏û‡∏¥‡πà‡∏° Text Label ‡∏ö‡∏ô Bar
            svg.selectAll(".label")
                .data(chartData)
                .enter().append("text")
                .attr("class", "label")
                .attr("x", d => x(d.point) + x.bandwidth() / 2)
                .attr("y", d => y(d.amount))
                .attr("dy", "-0.3em") 
                .attr("text-anchor", "middle")
                .style("font-size", "0.65rem")
                .style("font-weight", "bold")
                .style("fill", "#1e293b") 
                .text(d => d.amount.toFixed(2));
                
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ß‡∏≤‡∏î‡∏Å‡∏£‡∏≤‡∏ü‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£ Resize
        function handleResize() {
            if (latestRainfallData.length > 0) {
                 drawRainfallBarChart(latestRainfallData);
            }
        }
        
        window.addEventListener('resize', handleResize);


        /**
         * ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡πÅ‡∏•‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏π‡∏ö‡∏ô‡πâ‡∏≥
         */
        function updateTable(elementId, data) {
            const container = document.getElementById(elementId);
            if (!container) return;
            
            container.innerHTML = ''; 
            
            const isPumpCardContainer = elementId === 'pump-status-card-container';
            
            const isError = data.length === 0 || (data.length > 0 && (data[0]?.['ERROR_KEY'] || '').includes('Error'));
            const colSpan = 4; // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á

            if (isError) {
                const errorMessage = '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ (‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö URL/‡∏Å‡∏≤‡∏£‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà ‡πÅ‡∏•‡∏∞‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå)';
                
                if (!isPumpCardContainer) { 
                    container.innerHTML = `
                        <tr>
                            <td colspan="${colSpan}" class="p-8 text-center text-red-500 bg-red-50/50">
                                <i data-lucide="CloudOff" class="w-6 h-6 mx-auto mb-2"></i>
                                ${errorMessage}
                            </td>
                        </tr>
                    `;
                } else {
                    // ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î Error Card ‡πÉ‡∏´‡πâ‡πÄ‡∏•‡πá‡∏Å‡∏•‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏û‡∏≠‡∏î‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà Green Area
                    container.innerHTML = `
                        <div class="col-span-full w-full p-4 text-center text-red-500 bg-red-50/50 rounded-lg">
                            <i data-lucide="CloudOff" class="w-6 h-6 mx-auto mb-2"></i>
                            ${errorMessage}
                        </div>
                    `;
                }
            } else {
                // Render data
                if (isPumpCardContainer) {
                    // For Sheet 3 Cards
                    data.forEach(item => {
                        container.innerHTML += createPumpStatusCard(item);
                    });
                } else {
                    // For Sheet 1 & 2 Tables
                    data.forEach(item => {
                        container.innerHTML += createWaterTableRow(item, elementId === 'water-level-table-body'); 
                    });
                }
            }

            // ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏° HTML ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏ô DOM
            lucide.createIcons();
        }

        /**
         * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠ URL ‡∏¢‡∏±‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°)
         */
        function checkPlaceholderUrls() {
            const errorElement = document.getElementById('url-placeholder-error');
            if (PLACEHOLDER_URL_CHECK) {
                errorElement.innerHTML = `
                    <div class="mt-4 p-3 bg-red-100 border border-red-300 rounded-lg text-red-800 font-medium">
                        ‚ö†Ô∏è ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: URL ‡∏¢‡∏±‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô!
                        <span class="block mt-1 font-normal text-sm">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà GOOGLE_SHEET_URL_1 ‡∏ñ‡∏∂‡∏á 4 ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î JS ‡∏î‡πâ‡∏ß‡∏¢‡∏•‡∏¥‡∏á‡∏Å‡πå CSV ‡∏ó‡∏µ‡πà‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏Ç‡∏≠‡∏á‡∏ó‡πà‡∏≤‡∏ô</span>
                    </div>
                `;
                const lastUpdateTimeElement = document.getElementById('last-update-time');
                if (lastUpdateTimeElement) {
                    lastUpdateTimeElement.textContent = '‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï (‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î URL)';
                    lastUpdateTimeElement.classList.remove('animate-pulse');
                    lastUpdateTimeElement.classList.add('text-red-500');
                }
                return true;
            } else {
                errorElement.innerHTML = '';
                return false;
            }
        }

        // =================================================================================================================================================
        // ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 4: ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Dashboard (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°)
        // =================================================================================================================================================

        let isUpdating = false;

        async function updateDashboard() {
            if (isUpdating || checkPlaceholderUrls()) {
                return;
            }
            isUpdating = true;
            
            const lastUpdateTimeElement = document.getElementById('last-update-time');
            if (lastUpdateTimeElement) {
                lastUpdateTimeElement.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...';
                lastUpdateTimeElement.classList.add('animate-pulse');
                lastUpdateTimeElement.classList.remove('text-red-500'); 
            }

            try {
                const [
                    waterLevelData, 
                    chaoPhrayaData, 
                    pumpStatusData,
                    rainfallData
                ] = await Promise.all([
                    fetchWaterLevelData(),
                    fetchChaoPhrayaData(),
                    fetchPumpStatusData(),
                    fetchRainfallData() 
                ]);

                // 1. Sheet 1
                updateTable('water-level-table-body', waterLevelData); 
                // 2. Sheet 2
                updateTable('chaophraya-table-body', chaoPhrayaData); 
                // 3. Sheet 3 Cards
                updateTable('pump-status-card-container', pumpStatusData); 
                // 4. Sheet 4 Graph
                drawRainfallBarChart(rainfallData);
                
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏ß‡∏•‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
                const now = new Date();
                const timeString = now.toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
                
                if (lastUpdateTimeElement) {
                    lastUpdateTimeElement.textContent = `‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ${timeString}`;
                    lastUpdateTimeElement.classList.remove('animate-pulse');
                }

            } catch (error) {
                console.error("Critical error during dashboard update:", error);
                if (lastUpdateTimeElement) {
                    lastUpdateTimeElement.textContent = '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÑ‡∏î‡πâ (‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Console)';
                    lastUpdateTimeElement.classList.remove('animate-pulse');
                    lastUpdateTimeElement.classList.add('text-red-500');
                }
            } finally {
                isUpdating = false;
            }
        }

        // =================================================================================================================================================
        // ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 5: ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (Initialization)
        // =================================================================================================================================================

        document.addEventListener('DOMContentLoaded', () => {
            checkPlaceholderUrls();
            
            if (!PLACEHOLDER_URL_CHECK) {
                updateDashboard();
                setInterval(updateDashboard, UPDATE_INTERVAL_MS);
            }
            
            document.getElementById('refresh-button').addEventListener('click', updateDashboard);
            
            document.getElementById('inspection-modal').addEventListener('click', (event) => {
                if (event.target.id === 'inspection-modal' || event.target.closest('#modal-close-button')) {
                    closeInspectionModal();
                }
            });
        });

    </script>
    
    <!-- Header Section -->
    <header class="mb-6 flex-shrink-0"> 
        <div class="flex items-center justify-between flex-wrap gap-4">
            <div>
                <h1 class="text-3xl font-extrabold text-gray-800">
                    Dashboard ‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡πâ‡∏≥‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°
                </h1>
                <p class="text-gray-500 mt-1">
                    ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥ ‡πÅ‡∏•‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏π‡∏ö‡∏ô‡πâ‡∏≥‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå
                </p>
                <!-- Area for URL Placeholder Error Message -->
                <div id="url-placeholder-error"></div>
            </div>
            <div class="flex items-center space-x-3">
                <span id="last-update-time" class="text-sm font-medium text-gray-600 transition-all duration-500">
                    ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...
                </span>
                <button id="refresh-button" class="flex items-center px-4 py-2 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 transition duration-300 transform hover:scale-105">
                    <i data-lucide="RefreshCw" class="w-4 h-4 mr-2"></i>
                    ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                </button>
            </div>
        </div>
    </header>
    
    <!-- Main Content Container: ‡πÉ‡∏ä‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î -->
    <main class="custom-dashboard-grid md:h-[calc(100vh-100px)]"> 
            
        <!-- 1. Area 1 (Sheet URL 1: ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡∏±‡∏î‡∏£‡∏∞‡∏î‡∏±‡∏ö) - Orange Area (8/12 width, ~60% height) -->
        <div class="area-1-orange bg-white p-6 rounded-xl shadow-lg flex flex-col overflow-hidden">
            <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center flex-shrink-0">
                <i data-lucide="Gauge" class="w-5 h-5 mr-2 text-orange-600"></i>
                ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡∏±‡∏î‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥ (4 ‡∏à‡∏∏‡∏î - 4 ‡∏£‡∏≠‡∏ö/‡∏ß‡∏±‡∏ô)
            </h2>
            <!-- ‡∏•‡∏ö overflow-y-auto ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å container ‡∏´‡∏•‡∏±‡∏Å ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ï‡πá‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà -->
            <div class="flex-grow -mx-6 px-6 overflow-y-auto"> 
                <table class="fluid-table divide-y divide-gray-200"> 
                    <thead class="bg-gray-50 sticky top-0 z-10 shadow-sm">
                        <tr>
                            <th class="table-th-area1 text-left uppercase tracking-wider whitespace-nowrap">
                                ‡∏à‡∏∏‡∏î‡∏ß‡∏±‡∏î
                            </th>
                            <th class="table-th-area1 text-left uppercase tracking-wider whitespace-nowrap">
                                ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
                            </th>
                            <th class="table-th-area1 text-center uppercase tracking-wider whitespace-nowrap">
                                ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á
                            </th>
                            <th class="table-th-area1 text-center uppercase tracking-wider whitespace-nowrap">
                                ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                            </th>
                        </tr>
                    </thead>
                    <tbody id="water-level-table-body" class="bg-white divide-y divide-gray-200">
                        <!-- Data rows will be injected by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 2. Area 2 (Sheet URL 2: ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡πÄ‡∏à‡πâ‡∏≤‡∏û‡∏£‡∏∞‡∏¢‡∏≤) - Yellow Area (4/12 width, ~60% height) -->
        <div class="area-2-yellow bg-white p-4 rounded-xl shadow-lg flex flex-col overflow-hidden">
            <h2 class="text-lg font-bold text-gray-800 mb-3 flex items-center flex-shrink-0">
                <i data-lucide="Waves" class="w-4 h-4 mr-1 text-yellow-600"></i>
                ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡πÄ‡∏à‡πâ‡∏≤‡∏û‡∏£‡∏∞‡∏¢‡∏≤ (4 ‡∏à‡∏∏‡∏î - 3 ‡∏£‡∏≠‡∏ö/‡∏ß‡∏±‡∏ô)
            </h2>
            <!-- ‡∏•‡∏ö overflow-y-auto ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å container ‡∏´‡∏•‡∏±‡∏Å ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ï‡πá‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà -->
            <div class="flex-grow -mx-4 px-4 overflow-y-auto">
                <table class="fluid-table divide-y divide-gray-200">
                    <thead class="bg-gray-50 sticky top-0 z-10 shadow-sm">
                        <tr>
                            <th class="table-th-area2 text-left uppercase tracking-wider whitespace-nowrap">
                                ‡∏à‡∏∏‡∏î‡∏ß‡∏±‡∏î
                            </th>
                            <th class="table-th-area2 text-left uppercase tracking-wider whitespace-nowrap">
                                ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥
                            </th>
                            <th class="table-th-area2 text-center uppercase tracking-wider whitespace-nowrap">
                                ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á
                            </th>
                            <th class="table-th-area2 text-center uppercase tracking-wider whitespace-nowrap">
                                ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                            </th>
                        </tr>
                    </thead>
                    <tbody id="chaophraya-table-body" class="bg-white divide-y divide-gray-200">
                        <!-- Data rows will be injected by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- 3. Area 3 (Sheet URL 4: ‡∏Å‡∏£‡∏≤‡∏ü‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏ô‡πâ‡∏≥‡∏ù‡∏ô) - Blue Area (4/12 width, ~40% height) -->
        <div class="area-3-blue bg-white p-6 rounded-xl shadow-lg flex flex-col overflow-hidden">
            <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center flex-shrink-0">
                <i data-lucide="CloudRain" class="w-5 h-5 mr-2 text-blue-600"></i>
                ‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏ô‡πâ‡∏≥‡∏ù‡∏ô (‡∏°‡∏°.) ‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤
            </h2>
            <!-- Chart Container: flex-grow ‡∏ó‡∏≥‡πÉ‡∏´‡πâ Container ‡∏¢‡∏∑‡∏î‡πÄ‡∏ï‡πá‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ -->
            <div id="rainfall-chart-container" class="w-full flex-grow min-h-[50px]"> 
                <!-- Chart will be drawn here, or error message will be displayed -->
            </div>
        </div>


        <!-- 4. Area 4 (Sheet URL 3: ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏π‡∏ö‡∏ô‡πâ‡∏≥ - CARDS) - Green Area (8/12 width, ~40% height) -->
        <div class="area-4-green bg-white p-6 rounded-xl shadow-lg flex flex-col overflow-hidden">
            <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center flex-shrink-0">
                <i data-lucide="Box" class="w-5 h-5 mr-2 text-green-600"></i>
                ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏π‡∏ö‡∏ô‡πâ‡∏≥ (14 ‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ)
            </h2>
            <!-- Card Container: ‡πÉ‡∏ä‡πâ Grid ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡πÅ‡∏ö‡∏ö Auto-Fit ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ Card ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏ñ‡∏ß‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ -->
            <div id="pump-status-card-container" class="grid gap-2 overflow-y-auto flex-grow" 
                style="grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));">
                <!-- Cards will be injected by JavaScript -->
            </div>
        </div>
        
    </main>

    <!-- Footer Section -->
    <footer class="mt-4 flex-shrink-0 text-center text-sm text-gray-400">
        <p>Dashboard Powered by Gemini and deployed on GitHub Pages.</p>
        <p class="mt-1 font-semibold text-gray-600">
            **‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:** ‡∏´‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡πÇ‡∏´‡∏•‡∏î ‡∏´‡∏£‡∏∑‡∏≠‡∏Ç‡∏∂‡πâ‡∏ô‡∏ß‡πà‡∏≤ "‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï" ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö GOOGLE_SHEET_URL ‡∏ó‡∏±‡πâ‡∏á 4 ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ß‡πà‡∏≤‡∏ñ‡∏π‡∏Å‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏ß‡∏¢‡∏•‡∏¥‡∏á‡∏Å‡πå CSV ‡∏ó‡∏µ‡πà‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        </p>
    </footer>

    <!-- Modal Structure for Pump Inspection Count -->
    <div id="inspection-modal" class="hidden fixed inset-0 z-50 bg-gray-900 bg-opacity-75 flex items-center justify-center transition-opacity duration-300">
        <!-- Modal Content (No change) -->
        <div class="bg-white rounded-xl shadow-2xl max-w-sm w-full p-6 m-4 transform transition-all sm:my-8 sm:align-middle">
            <div class="flex justify-between items-start mb-4 border-b pb-3">
                <h3 class="text-xl font-bold text-gray-800 flex items-center">
                    <i data-lucide="ClipboardList" class="w-6 h-6 mr-2 text-indigo-600"></i>
                    ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ
                </h3>
                <button id="modal-close-button" class="text-gray-400 hover:text-gray-600 transition" onclick="closeInspectionModal()">
                    <i data-lucide="X" class="w-6 h-6"></i>
                </button>
            </div>
            
            <div class="space-y-4">
                <p class="text-gray-600">
                    <span class="font-semibold text-gray-800">‡∏™‡∏ñ‡∏≤‡∏ô‡∏µ:</span> 
                    <span id="modal-station-name" class="text-indigo-700 font-bold"></span>
                </p>
                <div class="p-4 bg-gray-50 border border-gray-200 rounded-lg">
                    <p class="text-sm text-gray-500 mb-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏ï‡∏£‡∏ß‡∏à (‡∏™‡∏∞‡∏™‡∏°)</p>
                    <p id="modal-inspection-count" class="text-4xl font-extrabold text-blue-600">
                        0
                    </p>
                    <p class="text-xs text-gray-500 mt-2">* ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ó‡∏µ‡πà‡∏ó‡πà‡∏≤‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏ô USER_COLUMN_NAMES</p>
                </div>
            </div>
            
            <div class="mt-6 flex justify-end">
                <button type="button" class="px-4 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition" onclick="closeInspectionModal()">
                    ‡∏õ‡∏¥‡∏î
                </button>
            </div>
        </div>
    </div>
    <!-- End Modal Structure -->

</body>
</html>
